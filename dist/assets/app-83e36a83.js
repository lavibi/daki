(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();class E{constructor(e,t,n={}){this.control=e,this.deleteControl=t,this.options=n,typeof t=="object"&&(this.options=t,this.deleteControl=e,this.control=null),this.controlEl=this.control?document.querySelector(this.control):null,this.setEventListener()}async delete(e){const t=e.target.closest(this.deleteControl);if(!t||(e.preventDefault(),!confirm("Do you want to delete?")))return;const i=t.getAttribute("href");(await(await fetch(i)).json()).error||this.options&&this.options.parent&&e.target.closest(this.options.parent).remove()}setEventListener(){if(this.controlEl){this.controlEl.addEventListener("click",t=>this.delete(t));return}document.querySelectorAll(this.deleteControl).forEach(t=>{t.addEventListener("click",n=>this.delete(n))})}}function p(r,e,t={}){return new E(r,e,t)}class b{constructor(e,t,n,i,s,l,c={}){this.input=e,this.fakeInput=t,this.preview=n,this.control=i,this.button=s,this.list=l,this.options={addDelete:!0,addClass:"",...c},this.element=null,this.fakeInputEl=null,this.inputEl=null,this.isUploading=!1,this.setEvent()}browse(e){e.target.closest(this.fakeInput)&&(e.preventDefault(),!this.isUploading&&document.querySelector(this.input).click())}choose(e){const t=e.target.closest(this.input);if(t&&!this.isUploading&&t.files&&t.files[0]){const n=t.files[0];if(n.type!=="image/png"&&n.type!=="image/jpg"&&n.type!=="image/jpeg"&&n.type!=="image/gif"){t.value="",document.querySelector(this.preview).setAttribute("src",""),document.querySelector(this.control).classList.remove("flex"),document.querySelector(this.control).classList.add("hidden");return}const i=new FileReader;i.onload=s=>{document.querySelector(this.preview).setAttribute("src",s.target.result),document.querySelector(this.control).classList.remove("hidden"),document.querySelector(this.control).classList.add("flex")},i.readAsDataURL(n)}}async upload(e){const t=e.target.closest(this.button);if(!t||(e.preventDefault(),this.isUploading))return;this.isUploading=!0;const n=t.getAttribute("data-link"),i=t.getAttribute("data-name");t.innerHTML="...";const s=new FormData,l=document.querySelector(this.input);s.append(i,l.files[0]);const c=await fetch(n,{method:"POST",body:s});if(c.status!==200){alert("Upload error: ("+c.status+")"+c.statusText),this.isUploading=!1,t.innerHTML="+";return}const a=await c.json();document.querySelector(this.preview).setAttribute("src",""),document.querySelector(this.control).classList.remove("flex"),document.querySelector(this.control).classList.add("hidden"),l.value="",t.innerHTML="+",this.isUploading=!1,this.addNewImageElement(a.id,a.file)}addNewImageElement(e,t){const n=document.createElement("div");n.id="file-"+e,n.className="media-file flex justify-center items-center w-150px h-150px shadow mr-4 mb-4 p-2 relative "+this.options.addClass,n.innerHTML=`
      <img class="max-h-full" src="${t}">
      ${this.options.addDelete?`
        <div class="absolute right-3 bottom-3">
          <a class="media-file-del font-bold cursor-pointer py-1 px-2 text-sm rounded border border-red-700 bg-red-600 focus:outline-none text-white" href="./file/${e}/delete">x</a>
        </div>
        `:""}
    `;const i=document.querySelector(this.list),s=i.children[0].nextSibling;i.insertBefore(n,s)}setEvent(){if(this.options.element){if(this.element=document.querySelector(this.options.element),!this.element)return;this.element.addEventListener("click",e=>this.upload(e)),this.element.addEventListener("change",e=>this.choose(e)),this.element.addEventListener("click",e=>this.browse(e));return}this.fakeInputEl=document.querySelector(this.fakeInput),this.fakeInputEl.addEventListener("click",e=>this.browse(e)),this.inputEl=document.querySelector(this.input),this.inputEl.addEventListener("change",e=>this.choose(e)),this.buttonEl=document.querySelector(this.button),this.buttonEl.addEventListener("click",e=>this.upload(e))}}const g=(r,e,t,n,i,s,l={})=>new b(r,e,t,n,i,s,l),L=()=>{g("#file-browser","#file-trigger-browser","#file-preview","#form-upload-control","#form-upload-button","#media-list"),p("#media-list",".media-file-del",{parent:".media-file"})},S={element:null},o={init:!1,modalStack:[],openOverlay:()=>{document.getElementById("modal").classList.remove("hidden"),document.body.classList.add("overflow-hidden")},closeOverlay:()=>{document.getElementById("modal").classList.add("hidden"),document.body.classList.remove("overflow-hidden")}};class u{constructor(e,t,n={}){n={...S,...n},this.control=typeof e=="object"?e:document.querySelectorAll(e),this.control.length!==0&&(this.element=document.querySelector(t),this.options=n,this.closeControl=this.element.querySelectorAll(".modal-close"),this._setEventListener(),o.init||this._initGlobal())}showEvent(e){e.preventDefault(),o.modalStack.length>0?o.modalStack[o.modalStack.length-1].hide():o.openOverlay(),this.show(),this._show(),o.modalStack.push(this)}hideEvent(e){e.target.closest(".modal-close")&&(e.preventDefault(),this.hide(),this._hide())}_show(){document.getElementById("modal").scrollTop=0}_hide(){if(o.modalStack.pop(),o.modalStack.length===0)return o.closeOverlay();o.modalStack[o.modalStack.length-1].show()}hide(){this.element.classList.add("hidden")}show(){this.element.classList.remove("hidden")}_setEventListener(){for(const e of this.closeControl)e.addEventListener("click",t=>this.hideEvent(t));for(const e of this.control)e.addEventListener("click",t=>this.showEvent(t))}_initGlobal(){document.getElementById("modal").addEventListener("click",e=>u.hideGlobal(e)),document.addEventListener("keydown",e=>u.hideGlobal(e)),o.init=!0}static hideGlobal(e){if(o.modalStack.length!==0&&!(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA")&&(e.target.id==="modal"||e.keyCode===27)){if(o.modalStack.pop().hide(),o.modalStack.length===0)return o.closeOverlay();o.modalStack[o.modalStack.length-1].show()}}}function h(r,e,t={}){return new u(r,e,t)}class w{constructor(e,t,n={}){this.control=e,this.form=t,this.options=n,typeof t=="object"&&(this.control=null,this.form=e,this.options=t),this.controlEl=this.control?document.querySelector(this.control):null,this.isSubmitted=!1,this.setEvents()}async submit(e){if(this.controlEl&&!e.target.closest(this.form)||(e.preventDefault(),this.isSubmitted))return;this.isSubmitted=!0;const t=e.target,n=new FormData(t),i=t.getAttribute("data-reset")==="1",s="post",l=t.getAttribute("action"),c=t.querySelector(".form-submit-text"),a=t.querySelector("button[type=submit]"),y=a.innerText;a.innerText="...",c.innerText="",c.classList.remove("text-indigo-500"),c.classList.remove("text-red-500");try{(await(await fetch(l,{method:s,body:n})).json()).error?(c.innerText="Submit failed, please check data and try again.",c.classList.add("text-red-500")):(c.innerText="Submit successed.",c.classList.add("text-indigo-500"),i&&t.reset())}catch{c.innerText="Please try again.",c.classList.add("text-red-500")}a.innerText=y,this.isSubmitted=!1}setEvents(){if(this.controlEl){this.controlEl.addEventListener("submit",e=>this.submit(e));return}document.querySelectorAll(this.form).forEach(e=>{e.addEventListener("submit",t=>this.submit(t))})}}const k=(r,e,t={})=>new w(r,e,t),f=document.querySelectorAll(".thing-trans"),m=document.getElementById("file-selection"),d=document.getElementById("file-selection-remove"),I=()=>{if(p(".thing-delete",{parent:".thing"}),k("body",".form-data",{}),g("#file-browser","#file-trigger-browser","#file-preview","#form-upload-control","#form-upload-button","#media-list",{element:"#file-selection-modal",addDelete:!1,addClass:"cursor-pointer"}),h(f,"#thing-trans-modal"),f.forEach(r=>{r.addEventListener("click",async e=>{e.preventDefault(),document.getElementById("thing-trans-modal").querySelector(".modal-container").innerHTML="... loading";const t=r.getAttribute("href"),i=await(await fetch(t)).text();document.getElementById("thing-trans-modal").querySelector(".modal-container").innerHTML=i})}),m){h("#file-selection","#file-selection-modal"),m.addEventListener("click",async e=>{e.preventDefault(),document.getElementById("file-selection-modal").querySelector(".modal-container").innerHTML="... loading";const t=m.getAttribute("href"),i=await(await fetch(t)).text();document.getElementById("file-selection-modal").querySelector(".modal-container").innerHTML=i;const s=document.getElementById("file-selection-input").value,l=document.getElementById("file-"+s);l&&(l.classList.add("border-4"),l.classList.add("border-indigo-500"))}),document.getElementById("file-selection-modal").addEventListener("click",e=>{const t=e.target.closest(".media-file");if(!t)return;e.preventDefault();const n=t.id.replace("file-",""),i=t.querySelector("img").getAttribute("src");document.getElementById("file-selection-input").value=n,document.getElementById("file-selection-preview").setAttribute("src",i),document.querySelectorAll(".media-file").forEach(s=>{s.classList.remove("border-4"),s.classList.remove("border-indigo-500")}),t.classList.add("border-4"),t.classList.add("border-indigo-500"),d&&d.classList.remove("hidden")}),d&&d.addEventListener("click",e=>{e.preventDefault(),document.getElementById("file-selection-input").value="",document.getElementById("file-selection-preview").setAttribute("src",""),d.classList.add("hidden")});const r=document.querySelector("form");r&&d&&r.addEventListener("reset",e=>{document.getElementById("file-selection-input").value="",document.getElementById("file-selection-preview").setAttribute("src",""),d.classList.add("hidden")})}},q=()=>{document.body.classList.contains("page-file")&&L(),document.body.classList.contains("page-thing")&&I()};document.addEventListener("DOMContentLoaded",q);
