!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.daki=t():e.daki=t()}(window,(function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);class n{constructor(e,t,i={}){this.control=e,this.deleteControl=t,this.options=i,"object"==typeof t&&(this.options=t,this.deleteControl=e,this.control=null),this.controlEl=this.control?document.querySelector(this.control):null,this.setEventListener()}async delete(e){const t=e.target.closest(this.deleteControl);if(!t)return;e.preventDefault();if(!confirm("Do you want to delete?"))return;const i=t.getAttribute("href"),n=await fetch(i);(await n.json()).error||this.options&&this.options.parent&&e.target.closest(this.options.parent).remove()}setEventListener(){if(this.controlEl)return void this.controlEl.addEventListener("click",e=>this.delete(e));document.querySelectorAll(this.deleteControl).forEach(e=>{e.addEventListener("click",e=>this.delete(e))})}}var o=function(e,t,i={}){return new n(e,t,i)};class s{constructor(e,t,i,n,o,s,l={}){this.input=e,this.fakeInput=t,this.preview=i,this.control=n,this.button=o,this.list=s,this.options={addDelete:!0,addClass:"",...l},this.element=null,this.fakeInputEl=null,this.inputEl=null,this.isUploading=!1,this.setEvent()}browse(e){e.target.closest(this.fakeInput)&&(e.preventDefault(),this.isUploading||document.querySelector(this.input).click())}choose(e){const t=e.target.closest(this.input);if(t&&!this.isUploading&&t.files&&t.files[0]){const e=t.files[0];if("image/png"!==e.type&&"image/jpg"!==e.type&&"image/jpeg"!==e.type&&"image/gif"!==e.type)return t.value="",document.querySelector(this.preview).setAttribute("src",""),document.querySelector(this.control).classList.remove("flex"),void document.querySelector(this.control).classList.add("hidden");const i=new FileReader;i.onload=e=>{document.querySelector(this.preview).setAttribute("src",e.target.result),document.querySelector(this.control).classList.remove("hidden"),document.querySelector(this.control).classList.add("flex")},i.readAsDataURL(e)}}async upload(e){const t=e.target.closest(this.button);if(!t)return;if(e.preventDefault(),this.isUploading)return;this.isUploading=!0;const i=t.getAttribute("data-link"),n=t.getAttribute("data-name");t.innerHTML="...";const o=new FormData,s=document.querySelector(this.input);o.append(n,s.files[0]);const l=await fetch(i,{method:"POST",body:o});if(200!==l.status)return alert("Upload error: ("+l.status+")"+l.statusText),this.isUploading=!1,void(t.innerHTML="+");const r=await l.json();document.querySelector(this.preview).setAttribute("src",""),document.querySelector(this.control).classList.remove("flex"),document.querySelector(this.control).classList.add("hidden"),s.value="",t.innerHTML="+",this.isUploading=!1,this.addNewImageElement(r.id,r.file)}addNewImageElement(e,t){const i=document.createElement("div");i.id="file-"+e,i.className="media-file flex justify-center items-center w-150px h-150px shadow mr-4 mb-4 p-2 relative "+this.options.addClass,i.innerHTML=`\n      <img class="max-h-full" src="${t}">\n      ${this.options.addDelete?`\n        <div class="absolute right-3 bottom-3">\n          <a class="media-file-del font-bold cursor-pointer py-1 px-2 text-sm rounded border border-red-700 bg-red-600 focus:outline-none text-white" href="/file/${e}/delete">x</a>\n        </div>\n        `:""}\n    `;const n=document.querySelector(this.list),o=n.children[0].nextSibling;n.insertBefore(i,o)}setEvent(){if(this.options.element){if(this.element=document.querySelector(this.options.element),!this.element)return;return this.element.addEventListener("click",e=>this.upload(e)),this.element.addEventListener("change",e=>this.choose(e)),void this.element.addEventListener("click",e=>this.browse(e))}this.fakeInputEl=document.querySelector(this.fakeInput),this.fakeInputEl.addEventListener("click",e=>this.browse(e)),this.inputEl=document.querySelector(this.input),this.inputEl.addEventListener("change",e=>this.choose(e)),this.buttonEl=document.querySelector(this.button),this.buttonEl.addEventListener("click",e=>this.upload(e))}}var l=(e,t,i,n,o,l,r={})=>new s(e,t,i,n,o,l,r);const r={element:null},d={init:!1,modalStack:[],openOverlay:()=>{document.getElementById("modal").classList.remove("hidden"),document.body.classList.add("overflow-hidden")},closeOverlay:()=>{document.getElementById("modal").classList.add("hidden"),document.body.classList.remove("overflow-hidden")}};class c{constructor(e,t,i={}){i={...r,...i},this.control="object"==typeof e?e:document.querySelectorAll(e),0!==this.control.length&&(this.element=document.querySelector(t),this.options=i,this.closeControl=this.element.querySelectorAll(".modal-close"),this._setEventListener(),d.init||this._initGlobal())}showEvent(e){e.preventDefault(),d.modalStack.length>0?d.modalStack[d.modalStack.length-1].hide():d.openOverlay(),this.show(),this._show(),d.modalStack.push(this)}hideEvent(e){e.target.closest(".modal-close")&&(e.preventDefault(),this.hide(),this._hide())}_show(){document.getElementById("modal").scrollTop=0}_hide(){if(d.modalStack.pop(),0===d.modalStack.length)return d.closeOverlay();d.modalStack[d.modalStack.length-1].show()}hide(){this.element.classList.add("hidden")}show(){this.element.classList.remove("hidden")}_setEventListener(){for(const e of this.closeControl)e.addEventListener("click",e=>this.hideEvent(e));for(const e of this.control)e.addEventListener("click",e=>this.showEvent(e))}_initGlobal(){document.getElementById("modal").addEventListener("click",e=>c.hideGlobal(e)),document.addEventListener("keydown",e=>c.hideGlobal(e)),d.init=!0}static hideGlobal(e){if(0!==d.modalStack.length&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&("modal"===e.target.id||27===e.keyCode)){if(d.modalStack.pop().hide(),0===d.modalStack.length)return d.closeOverlay();d.modalStack[d.modalStack.length-1].show()}}}var a=function(e,t,i={}){return new c(e,t,i)};class u{constructor(e,t,i={}){this.control=e,this.form=t,this.options=i,"object"==typeof t&&(this.control=null,this.form=e,this.options=t),this.controlEl=this.control?document.querySelector(this.control):null,this.isSubmitted=!1,this.setEvents()}async submit(e){if(this.controlEl&&!e.target.closest(this.form))return;if(e.preventDefault(),this.isSubmitted)return;this.isSubmitted=!0;const t=e.target,i=new FormData(t),n="1"===t.getAttribute("data-reset"),o=t.getAttribute("action"),s=t.querySelector(".form-submit-text"),l=t.querySelector("button[type=submit]"),r=l.innerText;l.innerText="...",s.innerText="",s.classList.remove("text-indigo-500"),s.classList.remove("text-red-500");try{const e=await fetch(o,{method:"post",body:i});(await e.json()).error?(s.innerText="Submit failed, please check data and try again.",s.classList.add("text-red-500")):(s.innerText="Submit successed.",s.classList.add("text-indigo-500"),n&&t.reset())}catch(e){s.innerText="Please try again.",s.classList.add("text-red-500")}l.innerText=r,this.isSubmitted=!1}setEvents(){this.controlEl?this.controlEl.addEventListener("submit",e=>this.submit(e)):document.querySelectorAll(this.form).forEach(e=>{e.addEventListener("submit",e=>this.submit(e))})}}const m=document.querySelectorAll(".thing-trans"),h=document.getElementById("file-selection"),f=document.getElementById("file-selection-remove");document.body.classList.contains("page-file")&&(l("#file-browser","#file-trigger-browser","#file-preview","#form-upload-control","#form-upload-button","#media-list"),o("#media-list",".media-file-del",{parent:".media-file"})),document.body.classList.contains("page-thing")&&(()=>{if(o(".thing-delete",{parent:".thing"}),((e,t,i={})=>{new u(e,t,i)})("body",".form-data",{}),l("#file-browser","#file-trigger-browser","#file-preview","#form-upload-control","#form-upload-button","#media-list",{element:"#file-selection-modal",addDelete:!1,addClass:"cursor-pointer"}),a(m,"#thing-trans-modal"),m.forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault(),document.getElementById("thing-trans-modal").querySelector(".modal-container").innerHTML="... loading";const i=e.getAttribute("href"),n=await fetch(i),o=await n.text();document.getElementById("thing-trans-modal").querySelector(".modal-container").innerHTML=o})}),h){a("#file-selection","#file-selection-modal"),h.addEventListener("click",async e=>{e.preventDefault(),document.getElementById("file-selection-modal").querySelector(".modal-container").innerHTML="... loading";const t=h.getAttribute("href"),i=await fetch(t),n=await i.text();document.getElementById("file-selection-modal").querySelector(".modal-container").innerHTML=n;const o=document.getElementById("file-selection-input").value,s=document.getElementById("file-"+o);s&&(s.classList.add("border-4"),s.classList.add("border-indigo-500"))}),document.getElementById("file-selection-modal").addEventListener("click",e=>{const t=e.target.closest(".media-file");if(!t)return;e.preventDefault();const i=t.id.replace("file-",""),n=t.querySelector("img").getAttribute("src");document.getElementById("file-selection-input").value=i,document.getElementById("file-selection-preview").setAttribute("src",n),document.querySelectorAll(".media-file").forEach(e=>{e.classList.remove("border-4"),e.classList.remove("border-indigo-500")}),t.classList.add("border-4"),t.classList.add("border-indigo-500"),f&&f.classList.remove("hidden")}),f&&f.addEventListener("click",e=>{e.preventDefault(),document.getElementById("file-selection-input").value="",document.getElementById("file-selection-preview").setAttribute("src",""),f.classList.add("hidden")});const e=document.querySelector("form");e&&f&&e.addEventListener("reset",e=>{document.getElementById("file-selection-input").value="",document.getElementById("file-selection-preview").setAttribute("src",""),f.classList.add("hidden")})}})()}])}));
//# sourceMappingURL=app.js.map