!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.daki=t():e.daki=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class i{constructor(e,t,n={}){this.control=e,this.deleteControl=t,this.options=n,"object"==typeof t&&(this.options=t,this.deleteControl=e,this.control=null),this.controlEl=this.control?document.querySelector(this.control):null,this.setEventListener()}async delete(e){const t=e.target.closest(this.deleteControl);if(!t)return;e.preventDefault();if(!confirm("Do you want to delete?"))return;const n=t.getAttribute("href"),i=await fetch(n);(await i.json()).error||this.options&&this.options.parent&&e.target.closest(this.options.parent).remove()}setEventListener(){if(this.controlEl)return void this.controlEl.addEventListener("click",e=>this.delete(e));document.querySelectorAll(this.deleteControl).forEach(e=>{e.addEventListener("click",e=>this.delete(e))})}}var o=function(e,t,n={}){return new i(e,t,n)};class s{constructor(e,t,n,i,o,s,r={}){this.input=e,this.fakeInput=t,this.preview=n,this.control=i,this.button=o,this.list=s,this.options={addDelete:!0,...r},this.element=null,this.fakeInputEl=null,this.inputEl=null,this.isUploading=!1,this.setEvent()}browse(e){e.target.closest(this.fakeInput)&&(e.preventDefault(),this.isUploading||document.querySelector(this.input).click())}choose(e){const t=e.target.closest(this.input);if(t&&!this.isUploading&&t.files&&t.files[0]){const e=t.files[0];if("image/png"!==e.type&&"image/jpg"!==e.type&&"image/jpeg"!==e.type&&"image/gif"!==e.type)return t.value="",document.querySelector(this.preview).setAttribute("src",""),document.querySelector(this.control).classList.remove("flex"),void document.querySelector(this.control).classList.add("hidden");const n=new FileReader;n.onload=e=>{document.querySelector(this.preview).setAttribute("src",e.target.result),document.querySelector(this.control).classList.remove("hidden"),document.querySelector(this.control).classList.add("flex")},n.readAsDataURL(e)}}async upload(e){const t=e.target.closest(this.button);if(!t)return;if(e.preventDefault(),this.isUploading)return;this.isUploading=!0;const n=t.getAttribute("data-link"),i=t.getAttribute("data-name");t.innerHTML="...";const o=new FormData,s=document.querySelector(this.input);o.append(i,s.files[0]);const r=await fetch(n,{method:"POST",body:o});if(200!==r.status)return alert("Upload error: ("+r.status+")"+r.statusText),this.isUploading=!1,void(t.innerHTML="+");const l=await r.json();document.querySelector(this.preview).setAttribute("src",""),document.querySelector(this.control).classList.remove("flex"),document.querySelector(this.control).classList.add("hidden"),s.value="",t.innerHTML="+",this.isUploading=!1,this.addNewImageElement(l.id,l.file)}addNewImageElement(e,t){const n=document.createElement("div");n.id="file-"+e,n.className="media-file flex justify-center items-center w-150px h-150px shadow mr-4 mb-4 p-2 relative",n.innerHTML=`\n      <img class="max-h-full" src="${t}">\n      ${this.options.addDelete?`\n        <div class="absolute right-3 bottom-3">\n          <a class="media-file-del font-bold cursor-pointer py-1 px-2 text-sm rounded border border-red-700 bg-red-600 focus:outline-none text-white" href="/file/${e}/delete">x</a>\n        </div>\n        `:""}\n    `;const i=document.querySelector(this.list),o=i.children[0].nextSibling;i.insertBefore(n,o)}setEvent(){if(this.options.element){if(this.element=document.querySelector(this.options.element),!this.element)return;return this.element.addEventListener("click",e=>this.upload(e)),this.element.addEventListener("change",e=>this.choose(e)),void this.element.addEventListener("click",e=>this.browse(e))}this.fakeInputEl=document.querySelector(this.fakeInput),this.fakeInputEl.addEventListener("click",e=>this.browse(e)),this.inputEl=document.querySelector(this.input),this.inputEl.addEventListener("change",e=>this.choose(e)),this.buttonEl=document.querySelector(this.button),this.buttonEl.addEventListener("click",e=>this.upload(e))}}var r=(e,t,n,i,o,r,l={})=>new s(e,t,n,i,o,r,l);const l={element:null},c={init:!1,modalStack:[],openOverlay:()=>{document.getElementById("modal").classList.remove("hidden"),document.body.classList.add("overflow-hidden")},closeOverlay:()=>{document.getElementById("modal").classList.add("hidden"),document.body.classList.remove("overflow-hidden")}};class a{constructor(e,t,n={}){n={...l,...n},this.control="object"==typeof e?e:document.querySelectorAll(e),0!==this.control.length&&(this.element=document.querySelector(t),this.options=n,this.closeControl=this.element.querySelectorAll(".modal-close"),this._setEventListener(),c.init||this._initGlobal())}showEvent(e){e.preventDefault(),c.modalStack.length>0?c.modalStack[c.modalStack.length-1].hide():c.openOverlay(),this.show(),this._show(),c.modalStack.push(this)}hideEvent(e){e.target.closest(".modal-close")&&(e.preventDefault(),this.hide(),this._hide())}_show(){document.getElementById("modal").scrollTop=0}_hide(){if(c.modalStack.pop(),0===c.modalStack.length)return c.closeOverlay();c.modalStack[c.modalStack.length-1].show()}hide(){this.element.classList.add("hidden")}show(){this.element.classList.remove("hidden")}_setEventListener(){for(const e of this.closeControl)e.addEventListener("click",e=>this.hideEvent(e));for(const e of this.control)e.addEventListener("click",e=>this.showEvent(e))}_initGlobal(){document.getElementById("modal").addEventListener("click",e=>a.hideGlobal(e)),document.addEventListener("keydown",e=>a.hideGlobal(e)),c.init=!0}static hideGlobal(e){if(0!==c.modalStack.length&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&("modal"===e.target.id||27===e.keyCode)){if(c.modalStack.pop().hide(),0===c.modalStack.length)return c.closeOverlay();c.modalStack[c.modalStack.length-1].show()}}}var d=function(e,t,n={}){return new a(e,t,n)};class u{constructor(e,t,n={}){this.control=e,this.form=t,this.options=n,"object"==typeof t&&(this.control=null,this.form=e,this.options=t),this.controlEl=this.control?document.querySelector(this.control):null,this.isSubmitted=!1,this.setEvents()}async submit(e){if(this.controlEl&&!e.target.closest(this.form))return;if(e.preventDefault(),this.isSubmitted)return;this.isSubmitted=!0;const t=e.target,n=new FormData(t),i="1"===t.getAttribute("data-reset"),o=t.getAttribute("action"),s=t.querySelector(".form-submit-text"),r=t.querySelector("button[type=submit]"),l=r.innerText;r.innerText="...",s.innerText="",s.classList.remove("text-indigo-500"),s.classList.remove("text-red-500");try{const e=await fetch(o,{method:"post",body:n});(await e.json()).error?(s.innerText="Submit failed, please check data and try again.",s.classList.add("text-red-500")):(s.innerText="Submit successed.",s.classList.add("text-indigo-500"),i&&t.reset())}catch(e){s.innerText="Please try again.",s.classList.add("text-red-500")}r.innerText=l,this.isSubmitted=!1}setEvents(){this.controlEl?this.controlEl.addEventListener("submit",e=>this.submit(e)):document.querySelectorAll(this.form).forEach(e=>{e.addEventListener("submit",e=>this.submit(e))})}}const h=document.querySelectorAll(".thing-trans"),m=document.getElementById("file-selection");document.body.classList.contains("page-file")&&(r("#file-browser","#file-trigger-browser","#file-preview","#form-upload-control","#form-upload-button","#media-list"),o("#media-list",".media-file-del",{parent:".media-file"})),document.body.classList.contains("page-thing")&&(o(".thing-delete",{parent:".thing"}),((e,t,n={})=>{new u(e,t,n)})("body",".form-data",{}),r("#file-browser","#file-trigger-browser","#file-preview","#form-upload-control","#form-upload-button","#media-list",{element:"#file-selection-modal",addDelete:!1}),d(h,"#thing-trans-modal"),h.forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault(),document.getElementById("thing-trans-modal").querySelector(".modal-container").innerHTML="... loading";const n=e.getAttribute("href"),i=await fetch(n),o=await i.text();document.getElementById("thing-trans-modal").querySelector(".modal-container").innerHTML=o})}),m&&(d("#file-selection","#file-selection-modal"),m.addEventListener("click",async e=>{e.preventDefault(),document.getElementById("file-selection-modal").querySelector(".modal-container").innerHTML="... loading";const t=m.getAttribute("href"),n=await fetch(t),i=await n.text();document.getElementById("file-selection-modal").querySelector(".modal-container").innerHTML=i}),document.getElementById("file-selection-modal").addEventListener("click",e=>{const t=e.target.closest(".media-file");if(!t)return;e.preventDefault();const n=t.id.replace("file-",""),i=t.querySelector("img").getAttribute("src");document.getElementById("file-selection-input").value=n,document.getElementById("file-selection-preview").setAttribute("src",i)})))}])}));
//# sourceMappingURL=app.js.map